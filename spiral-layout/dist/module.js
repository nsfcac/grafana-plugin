/*! For license information please see module.js.LICENSE.txt */
define(["react","d3","emotion","@grafana/ui","lodash","@grafana/data"],(function(e,t,n,a,r,i){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=6)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,n){"use strict";n.r(t);var a=n(5),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function l(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var s,c,u=n(0),d=n.n(u),p=n(2),h=n(3),f=n(1),m=n(4),v=f.timeFormat("%Y-%m-%dT%H:%M"),y=function(e){function t(t){var n=e.call(this,t)||this;return n.timer=null,n.state={currentIndex:t.value,isPlay:!1},n}return i(t,e),t.prototype.componentWillUnmount=function(){this.onStop()},t.prototype.componentDidUpdate=function(e,t,n){this.props.value!==e.value&&this.props.value!==this.state.currentIndex&&(this.setState({currentIndex:this.props.value}),this.onStop())},t.prototype.onPlay=function(){var e=this;this.state.isPlay?this.onStop():(this.setState({isPlay:!0}),this.timer&&this.timer.stop(),this.timer=f.interval((function(){var t=e.props.value+1;e.props.value+1>=e.props.timeStamp.length-1&&(t=e.props.timeStamp.length-1,e.onStop()),e.setState({currentIndex:t}),e.props.onChange(t)}),1e3))},t.prototype.onStop=function(){this.timer&&this.timer.stop(),this.setState({isPlay:!1})},t.prototype.render=function(){var e=this,t=this.props,n=t.value,a=t.timeStamp,r=this.state.isPlay,i=g();return d.a.createElement("div",{className:i.root},d.a.createElement(h.IconButton,{name:r?"pause":"play",size:"xl",onClick:this.onPlay.bind(this)}),d.a.createElement("div",{className:i.progressBarWrapper},d.a.createElement(h.Input,{name:"timePoint",css:!0,value:v(new Date(a[n])),type:"datetime-local",onChange:function(t){e.props.onChange(f.bisect(a,+new Date(t.currentTarget.value)))}})),d.a.createElement(h.Slider,{value:n,key:r?n:0,min:0,step:1,max:a.length-1,tooltipAlwaysVisible:!1,onChange:function(t){return e.props.onChange(null!=t?t:0)}}))},t}(d.a.Component),g=Object(h.stylesFactory)((function(){return{progressBarWrapper:Object(p.css)(s||(s=l(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),root:Object(p.css)(c||(c=l(["\n      display: -ms-flexbox;\n    display: flex;\n    -ms-flex-wrap: wrap;\n    flex-wrap: wrap;\n    width:270px;\n    & .rc-slider + div \n      {display: none}\n    "],["\n      display: -ms-flexbox;\n    display: flex;\n    -ms-flex-wrap: wrap;\n    flex-wrap: wrap;\n    width:270px;\n    & .rc-slider + div \n      {display: none}\n    "])))}})),b=function(e){var t=e.colorScale,n=e.range,a=e.height,r=void 0===a?30:a,i=e.barHeight,l=void 0===i?10:i,s=e.style,c=void 0===s?{}:s,u=(function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}}(e,["colorScale","range","height","barHeight","style"]),d.a.useMemo((function(){return Object(m.uniqueId)()}),[])),p=d.a.useMemo((function(){var e,a,r,i,o=t.domain(),l=o[0]>o[1]?n.slice().reverse():n.slice(),s=t.copy().domain([null!==(e=l[0])&&void 0!==e?e:0,null!==(a=l[1])&&void 0!==a?a:0]),c=Object(f.scaleLinear)().domain([null!==(r=l[0])&&void 0!==r?r:0,null!==(i=l[1])&&void 0!==i?i:0].sort((function(e,t){return e-t}))).range([0,100]);return{ticks:c.ticks(5).sort((function(e,t){return e-t})).map((function(e){return[e,c(e)]})),cloneColor:s}}),[t,n]),h=p.ticks,v=p.cloneColor;return d.a.createElement("svg",{style:o({width:"100%",height:r},c)},d.a.createElement("defs",null,d.a.createElement("linearGradient",{id:"linear-gradient"+u},h.map((function(e,t,n){return d.a.createElement("stop",{key:e[0],offset:e[1]+"%",stopColor:v(e[0])})})))),d.a.createElement("rect",{width:"100%",height:l,style:{fill:"url(#linear-gradient"+u+")"}}),h.map((function(e,t,n){return d.a.createElement("text",{key:e[0],x:e[1]+"%",dy:"1rem",y:l,fill:"currentColor"},Math.abs(e[0])>999?Object(f.format)(".2s")(e[0]):e[0])})))};var w,x,S,E,O,j,k,C=function(e){function t(t){var n,a=e.call(this,t)||this;return a.svgRef=d.a.createRef(),a.trajectory={bandwidth:10,thresholds:10,colorScheme:"interpolateViridis"},a.state={data:[],datas:[],dataByTime:{},dimensions:[],selectedService:"",selectedIndex:0,selectedTime:new Date,timeStamp:[],ranking:{byComputer:{},byMetric:{},byUser:{}},order:(n=new Array,n.object={},n)},a}return i(t,e),t.prototype.widthView=function(){var e;return this.props.width*(null!==(e=this.state.scalezoom)&&void 0!==e?e:1)},t.prototype.heightView=function(){var e;return this.props.height*(null!==(e=this.state.scalezoom)&&void 0!==e?e:1)},t.prototype.widthG=function(){var e,t;return this.widthView()-(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).left-(null!==(t=this.state.margin)&&void 0!==t?t:{top:0,bottom:0,left:0,right:0}).right},t.prototype.heightG=function(){var e,t;return this.heightView()-(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).top-(null!==(t=this.state.margin)&&void 0!==t?t:{top:0,bottom:0,left:0,right:0}).bottom},t.prototype.centerX=function(){var e;return(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).left+this.widthG()/2},t.prototype.centerY=function(){var e;return(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).top+this.heightG()/2},t.prototype.r=function(){var e;return(null!==(e=f.min([this.props.width,this.props.height]))&&void 0!==e?e:0)/2-20},t.prototype.componentDidMount=function(){var e,t,n,a=this.handleData();a.dimensions&&(a.selectedService=a.dimensions[0].key),a.timeStamp&&(a.selectedIndex=0,a.selectedTime=null!==(e=a.timeStamp[a.selectedIndex])&&void 0!==e?e:new Date),a.data=this.extractData(null!==(t=a.dataByTime)&&void 0!==t?t:{},null!==(n=a.selectedTime)&&void 0!==n?n:this.state.selectedTime),this.sortByService(a.data,""+a.selectedService),this.setState(a)},t.prototype.onChangeTime=function(e){var t,n,a=this,r={};r.selectedIndex=e,r.selectedTime=null!==(t=this.state.timeStamp[e])&&void 0!==t?t:new Date,r.data=this.extractData(this.state.dataByTime,null!==(n=r.selectedTime)&&void 0!==n?n:this.state.selectedTime),this.sortByService(r.data,this.state.selectedService),this.state.selectedData&&(r.selectedData=r.data.find((function(e){return a.state.selectedData.id===e.id}))),this.setState(r)},t.prototype.componentDidUpdate=function(e,t,n){var a,r,i;if(this.props.data!==e.data){var o=this.handleData();o.dimensions&&(o.selectedService=o.dimensions[0].key),o.timeStamp&&(o.selectedIndex=0,o.selectedTime=null!==(a=o.timeStamp[o.selectedIndex])&&void 0!==a?a:new Date),o.data=this.extractData(null!==(r=o.dataByTime)&&void 0!==r?r:{},null!==(i=o.selectedTime)&&void 0!==i?i:this.state.selectedTime),this.sortByService(o.data,""+o.selectedService),this.setState(o)}},t.prototype.sortByService=function(e,t){e.sort((function(e,n){return e[t]-n[t]})).forEach((function(e,t){return e.order=t}))},t.prototype.draw_trajectory_contours=function(e,t,n,a,r){var i,o,l=this,s=t;s=s.filter((function(e){return null!=e}));var c=f.contourDensity().x((function(e){return n(a(e))*Math.sin(r(a(e)))+l.centerX()})).y((function(e){return-n(a(e))*Math.cos(r(a(e)))+l.centerY()})).size([this.widthG(),this.heightG()]).bandwidth(this.trajectory.bandwidth)(s),u=m.last(f.contourDensity().size([this.widthG(),this.heightG()]).bandwidth(this.trajectory.bandwidth)(s.map((function(e){return[l.widthG()/2,l.heightG()/2]}))));if(u){var p=u.value,h=f.extent(c,(function(e){return e.value/p*100})),v=f.scaleSequential(f.interpolateViridis).domain([null!==(i=h[0])&&void 0!==i?i:0,null!==(o=h[1])&&void 0!==o?o:0]);return c.map((function(e){var t;return d.a.createElement("path",{className:"trajectory trajectoryPath",transform:"translate("+-l.centerX()+","+-l.centerY()+")",d:null!==(t=f.geoPath()(e))&&void 0!==t?t:"",style:{fill:v(e.value/p*100)}})}))}return""},t.prototype.handleData=function(){var e,t=this.props.data,n={},a=new Array,r=new Map,i=[],o={},l={},s={byComputer:{},byMetric:{},byUser:{}};function c(e,t,n){return{range:e,scale:f.scaleLinear().domain(e),order:t,key:n,active:new Array,tickFormat:void 0}}function u(e,t,l,s){var u,d;n[e]||(n[e]={});var p=o[t],h=p?[null!==(u=p.range[0])&&void 0!==u?u:1/0,null!==(d=p.range[1])&&void 0!==d?d:-1/0]:[1/0,-1/0];l.values.toArray().forEach((function(i,o){if(!n[e][s.values.get(o)]){var l={time:s.values.get(o),order:0,id:e};a.push(l),r.set(e,!0),n[e][s.values.get(o)]=l}n[e][s.values.get(o)][t]=i,null!==i&&(i<h[0]&&(h[0]=i),i>h[1]&&(h[1]=i))})),p?(p.range=h,p.scale.domain(h)):(o[t]=c(h,i.length,t),i.push(o[t]))}t.series.forEach((function(e){var t=e.fields.find((function(e){return"time"===e.name.trim().toLowerCase()}));t&&t.values.toArray().forEach((function(e){l[e]=e})),e.fields.find((function(e){return"name"===e.name}))?function(e){var t,l,s,u=null!==(t=e.refId)&&void 0!==t?t:"",d=e.fields.find((function(e){return"time"===e.name.trim().toLowerCase()})),p=e.fields.find((function(e){return"value"===e.name})),h=e.fields.find((function(e){return"name"===e.name})),f=o[u],m=f?[null!==(l=f.range[0])&&void 0!==l?l:1/0,null!==(s=f.range[1])&&void 0!==s?s:-1/0]:[1/0,-1/0];h&&h.values&&d&&d.values&&p&&p.values&&h.values.toArray().forEach((function(e,t){n.hasOwnProperty(e)||(n[e]={});var i=p.values.get(t);if(!n[e][d.values.get(t)]){var o={time:d.values.get(t),order:0,id:e};a.push(o),r.set(e,!0),n[e][d.values.get(t)]=o}n[e][d.values.get(t)][u]=i,i<m[0]&&(m[0]=i),i>m[1]&&(m[1]=i)})),f?(f.range=m,f.scale.domain(m)):(o[u]=c(m,i.length,u),i.push(o[u]))}(e):function(e){var t=e.fields.find((function(e){return"time"===e.name.trim().toLowerCase()}));t&&e.fields.filter((function(e){return"number"===e.type})).forEach((function(e){if(e.labels){var n=e.name,a="";if("value"===n){var r=Object.values(e.labels)[0].split("|").map((function(e){return e.trim()}));a=r[0].trim(),n=r[1].trim()}else a=Object.values(e.labels)[0].replace("|","").trim();u(a,n,e,t)}else if(2===e.name.split("|").length){var i=e.name.split("|");u(i[1].trim(),i[0].trim(),e,t)}}))}(e)})),i.sort((function(e,t){return e.order-t.order})).forEach((function(e,t){return e.order=t}));var d=null!==(e=Object.values(l).sort((function(e,t){return+e-+t})))&&void 0!==e?e:[];i.forEach((function(e){s.byMetric[e.key]=[]}));var p=Object.keys(n);return d.forEach((function(e,t){i.forEach((function(a){s.byMetric[a.key][t]={},p.map((function(t){return s.byComputer[t]||(s.byComputer[t]={}),s.byComputer[t][a.key]||(s.byComputer[t][a.key]=[]),{key:t,value:n[t][""+e][a.key]}})).sort((function(e,t){return-t.value+e.value})).forEach((function(e,n){s.byMetric[a.key][t][e.key]=n,s.byComputer[e.key][a.key][t]=n}))}))})),{dimensions:i,dataByTime:n,timeStamp:d,datas:a,ranking:s}},t.prototype.extractData=function(e,t){var n=[];return Object.values(e).forEach((function(e){e[""+t]&&n.push(e[""+t])})),n},t.prototype.render=function(){var e,t,n=this,a=D(),r=this.props,i=r.width,o=r.height,l=this.props.options,s=l.nodeSize,c=l.numberOfRing,u=l.orderType,p=this.state,h=p.data,m=p.dimensions,v=p.selectedService,g=p.selectedIndex,w=p.timeStamp,x=this.r(),S=2*Math.PI*c,E=function(e){return-(e-0)-0},O=f.scaleLinear().domain([0,S]).range([.1*x,x]),j=f.range(0,S+.001,(S-0)/1e3),k=f.radialLine().curve(f.curveCardinal).angle(E).radius(O),C=m.find((function(e){return e.key===v})),P=C?[null!==(e=C.range[0])&&void 0!==e?e:0,null!==(t=C.range[1])&&void 0!==t?t:0]:[0,0],T=f.scaleSequential().interpolator(f.interpolateSpectral).domain(P.slice().reverse()),M=f.scaleLinear().domain("rank"===u?[0,h.length-1]:P).range([0,S]),I="rank"===u?"order":v;return d.a.createElement("div",{style:{width:i+" px",height:o+" px",position:"relative"}},d.a.createElement("svg",{className:a.svg,width:i,height:o,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 "+i+" "+o,ref:this.svgRef},d.a.createElement("g",{className:"content",transform:"translate("+this.centerX()+","+this.centerY()+")"},d.a.createElement("defs",null),d.a.createElement("path",{id:"#spiral",d:""+k(j),style:{fill:"none",stroke:"lightgrey",strokeDasharray:"6 5",opacity:.2}}),d.a.createElement("g",null,this.state.selectedData?this.draw_trajectory_contours(this.state.selectedData,"rank"===u?this.state.ranking.byComputer[this.state.selectedData.id][v]:Object.values(this.state.dataByTime[this.state.selectedData.id]).map((function(e){return e[v]})),O,M,E):""),h.map((function(e){var t=M(e[null!=I?I:""]),a=E(t),r=O(t),i=r*Math.sin(a),o=-r*Math.cos(a);return d.a.createElement("circle",{cx:i,cy:o,r:s,fill:""+T(e[null!=v?v:""]),opacity:n.state.selectedData?n.state.selectedData===e?1:.1:1,onMouseOver:function(){n.state.freeze||n.setState({selectedData:e})},onClick:function(){n.state.freeze&&n.setState({selectedData:void 0}),n.setState({freeze:!n.state.freeze})},onMouseOut:function(){n.state.freeze||n.setState({selectedData:void 0})}})})))),d.a.createElement("div",{style:{position:"absolute"}},d.a.createElement("select",{value:v,onChange:function(e){n.sortByService(n.state.data,""+e.target.value),n.setState({selectedService:e.target.value})}},m.map((function(e){return d.a.createElement("option",{key:e.key,value:e.key},e.key)}))),d.a.createElement(y,{value:g,timeStamp:w,onChange:this.onChangeTime.bind(this)}),C&&d.a.createElement("div",{style:{width:"270px",marginTop:"10px",position:"relative"}},d.a.createElement("span",null,"Color legend"),d.a.createElement(b,{colorScale:T,range:C.range}))),this.state.selectedData?d.a.createElement("div",{className:a.tooltip},d.a.createElement("table",null,d.a.createElement("thead",null,d.a.createElement("tr",null,d.a.createElement("th",null,"Name"),d.a.createElement("th",null,"Value"))),d.a.createElement("tbody",null,d.a.createElement("tr",null,d.a.createElement("td",{className:a.tableCell},"Node"),d.a.createElement("td",{className:a.tableCell},this.state.selectedData.id)),m.map((function(e){return d.a.createElement("tr",{style:{fontWeight:e.key===v?"bold":"normal"}},d.a.createElement("td",{className:a.tableCell},e.key),d.a.createElement("td",{className:a.tableCell},n.state.selectedData?f.format(".2f")(n.state.selectedData[e.key]):"-"))}))))):"")},t.defaultProps={width:100,height:100,margin:{top:0,bottom:0,left:0,right:0},scalezoom:1},t}(d.a.Component),D=Object(h.stylesFactory)((function(){return{wrapper:Object(p.css)(w||(w=l(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),legend:Object(p.css)(x||(x=l(["\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow-y:auto;\n      max-height: 50%;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow-y:auto;\n      max-height: 50%;\n    "]))),legendColor:Object(p.css)(S||(S=l(["\n      width: 10px;\n      height: 10px;\n      margin-right:2px;\n      display: inline-block;\n    "],["\n      width: 10px;\n      height: 10px;\n      margin-right:2px;\n      display: inline-block;\n    "]))),svg:Object(p.css)(E||(E=l(["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "]))),tooltip:Object(p.css)(O||(O=l(["\n            position: absolute;\n      top: 0;\n      right: 0;\n        "],["\n            position: absolute;\n      top: 0;\n      right: 0;\n        "]))),textBox:Object(p.css)(j||(j=l(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "]))),tableCell:Object(p.css)(k||(k=l(["\n         padding-left: 5px;\n         padding-right: 5px;\n         "],["\n         padding-left: 5px;\n         padding-right: 5px;\n         "])))}}));n.d(t,"plugin",(function(){return P}));var P=new a.PanelPlugin(C).setPanelOptions((function(e){return e.addSelect({path:"orderType",name:"Order Type",defaultValue:"value",settings:{options:[{label:"Ranking",value:"rank"},{label:"Metric",value:"value"}]}}).addNumberInput({path:"numberOfRing",name:"#Ring",defaultValue:5}).addNumberInput({path:"nodeSize",name:"Node Size",defaultValue:5})}))}])}));
//# sourceMappingURL=module.js.map