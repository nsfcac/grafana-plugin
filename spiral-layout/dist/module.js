/*! For license information please see module.js.LICENSE.txt */
define(["react","d3","emotion","@grafana/ui","@grafana/data","lodash"],(function(e,t,n,a,r,i){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=6)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,n){"use strict";n.r(t);var a=n(4),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var o=n(0),l=n.n(o),s=n(2),c=n(3),u=n(1),d=n(5);var p,f,h,m,v,y,g,b=function(e){function t(t){var n,a=e.call(this,t)||this;return a.svgRef=l.a.createRef(),a.trajectory={bandwidth:10,thresholds:10,colorScheme:"interpolateViridis"},a.state={data:[],datas:[],dataByTime:{},dimensions:[],selectedService:"",selectedIndex:0,selectedTime:new Date,timeStamp:[],ranking:{byComputer:{},byMetric:{},byUser:{}},order:(n=new Array,n.object={},n)},a}return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.widthView=function(){var e;return this.props.width*(null!==(e=this.state.scalezoom)&&void 0!==e?e:1)},t.prototype.heightView=function(){var e;return this.props.height*(null!==(e=this.state.scalezoom)&&void 0!==e?e:1)},t.prototype.widthG=function(){var e,t;return this.widthView()-(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).left-(null!==(t=this.state.margin)&&void 0!==t?t:{top:0,bottom:0,left:0,right:0}).right},t.prototype.heightG=function(){var e,t;return this.heightView()-(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).top-(null!==(t=this.state.margin)&&void 0!==t?t:{top:0,bottom:0,left:0,right:0}).bottom},t.prototype.centerX=function(){var e;return(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).left+this.widthG()/2},t.prototype.centerY=function(){var e;return(null!==(e=this.state.margin)&&void 0!==e?e:{top:0,bottom:0,left:0,right:0}).top+this.heightG()/2},t.prototype.r=function(){var e;return(null!==(e=u.min([this.props.width,this.props.height]))&&void 0!==e?e:0)/2-20},t.prototype.componentDidMount=function(){var e,t,n,a=this.handleData();a.dimensions&&(a.selectedService=a.dimensions[0].key),a.timeStamp&&(a.selectedIndex=0,a.selectedTime=null!==(e=a.timeStamp[a.selectedIndex])&&void 0!==e?e:new Date),a.data=this.extractData(null!==(t=a.dataByTime)&&void 0!==t?t:{},null!==(n=a.selectedTime)&&void 0!==n?n:this.state.selectedTime),this.sortByService(a.data,""+a.selectedService),this.setState(a)},t.prototype.onChangeTime=function(e){var t,n,a=this,r={};r.selectedIndex=e,r.selectedTime=null!==(t=this.state.timeStamp[e])&&void 0!==t?t:new Date,r.data=this.extractData(this.state.dataByTime,null!==(n=r.selectedTime)&&void 0!==n?n:this.state.selectedTime),this.sortByService(r.data,this.state.selectedService),this.state.selectedData&&(r.selectedData=r.data.find((function(e){return a.state.selectedData.id===e.id}))),this.setState(r)},t.prototype.componentDidUpdate=function(e,t,n){var a,r,i;if(this.props.data!==e.data){var o=this.handleData();o.dimensions&&(o.selectedService=o.dimensions[0].key),o.timeStamp&&(o.selectedIndex=0,o.selectedTime=null!==(a=o.timeStamp[o.selectedIndex])&&void 0!==a?a:new Date),o.data=this.extractData(null!==(r=o.dataByTime)&&void 0!==r?r:{},null!==(i=o.selectedTime)&&void 0!==i?i:this.state.selectedTime),this.sortByService(o.data,""+o.selectedService),this.setState(o)}},t.prototype.sortByService=function(e,t){e.sort((function(e,n){return e[t]-n[t]})).forEach((function(e,t){return e.order=t}))},t.prototype.draw_trajectory_contours=function(e,t,n,a,r){var i,o,s=this,c=t;c=c.filter((function(e){return null!=e}));var p=u.contourDensity().x((function(e){return n(a(e))*Math.sin(r(a(e)))+s.centerX()})).y((function(e){return-n(a(e))*Math.cos(r(a(e)))+s.centerY()})).size([this.widthG(),this.heightG()]).bandwidth(this.trajectory.bandwidth)(c),f=d.last(u.contourDensity().size([this.widthG(),this.heightG()]).bandwidth(this.trajectory.bandwidth)(c.map((function(e){return[s.widthG()/2,s.heightG()/2]}))));if(f){var h=f.value,m=u.extent(p,(function(e){return e.value/h*100})),v=u.scaleSequential(u.interpolateViridis).domain([null!==(i=m[0])&&void 0!==i?i:0,null!==(o=m[1])&&void 0!==o?o:0]);return p.map((function(e){var t;return l.a.createElement("path",{className:"trajectory trajectoryPath",transform:"translate("+-s.centerX()+","+-s.centerY()+")",d:null!==(t=u.geoPath()(e))&&void 0!==t?t:"",style:{fill:v(e.value/h*100)}})}))}return""},t.prototype.handleData=function(){var e,t=this.props.data,n={},a=new Array,r=new Map,i=[],o={},l={},s={byComputer:{},byMetric:{},byUser:{}};function c(e,t,n){return{range:e,scale:u.scaleLinear().domain(e),order:t,key:n,active:new Array,tickFormat:void 0}}t.series.forEach((function(e){var t=e.fields.find((function(e){return"time"===e.name}));t&&t.values.toArray().forEach((function(e){l[e]=e})),e.fields.find((function(e){return"name"===e.name}))?function(e){var t,l,s,u=null!==(t=e.refId)&&void 0!==t?t:"",d=e.fields.find((function(e){return"time"===e.name})),p=e.fields.find((function(e){return"value"===e.name})),f=e.fields.find((function(e){return"name"===e.name})),h=o[u],m=h?[null!==(l=h.range[0])&&void 0!==l?l:1/0,null!==(s=h.range[1])&&void 0!==s?s:-1/0]:[1/0,-1/0];f&&f.values&&d&&d.values&&p&&p.values&&f.values.toArray().forEach((function(e,t){n.hasOwnProperty(e)||(n[e]={});var i=p.values.get(t);if(!n[e][d.values.get(t)]){var o={time:d.values.get(t),order:0,id:e};a.push(o),r.set(e,!0),n[e][d.values.get(t)]=o}n[e][d.values.get(t)][u]=i,i<m[0]&&(m[0]=i),i>m[1]&&(m[1]=i)})),h?(h.range=m,h.scale.domain(m)):(o[u]=c(m,i.length,u),i.push(o[u]))}(e):function(e){var t=e.fields.find((function(e){return"time"===e.name}));t&&e.fields.filter((function(e){return"number"===e.type})).forEach((function(e){var l,s;if(e.labels){var u=e.name,d="";if("value"===u){var p=Object.values(e.labels)[0].split("|");d=p[0].trim(),u=p[1].trim()}else d=Object.values(e.labels)[0].replace("|","").trim();n[d]||(n[d]={});var f=o[u],h=f?[null!==(l=f.range[0])&&void 0!==l?l:1/0,null!==(s=f.range[1])&&void 0!==s?s:-1/0]:[1/0,-1/0];e.values.toArray().forEach((function(e,i){if(!n[d][t.values.get(i)]){var o={time:t.values.get(i),order:0,id:d};a.push(o),r.set(d,!0),n[d][t.values.get(i)]=o}n[d][t.values.get(i)][u]=e,null!==e&&(e<h[0]&&(h[0]=e),e>h[1]&&(h[1]=e))})),f?(f.range=h,f.scale.domain(h)):(o[u]=c(h,i.length,u),i.push(o[u]))}}))}(e)})),i.sort((function(e,t){return e.order-t.order})).forEach((function(e,t){return e.order=t}));var d=null!==(e=Object.values(l).sort((function(e,t){return+e-+t})))&&void 0!==e?e:[];i.forEach((function(e){s.byMetric[e.key]=[]}));var p=Object.keys(n);return d.forEach((function(e,t){i.forEach((function(a){s.byMetric[a.key][t]={},p.map((function(t){return s.byComputer[t]||(s.byComputer[t]={}),s.byComputer[t][a.key]||(s.byComputer[t][a.key]=[]),{key:t,value:n[t][""+e][a.key]}})).sort((function(e,t){return-t.value+e.value})).forEach((function(e,n){s.byMetric[a.key][t][e.key]=n,s.byComputer[e.key][a.key][t]=n}))}))})),{dimensions:i,dataByTime:n,timeStamp:d,datas:a,ranking:s}},t.prototype.extractData=function(e,t){var n=[];return Object.values(e).forEach((function(e){e[""+t]&&n.push(e[""+t])})),n},t.prototype.render=function(){var e,t,n=this,a=w(),r=this.props,i=r.width,o=r.height,s=this.props.options,d=s.nodeSize,p=s.numberOfRing,f=s.orderType,h=this.state,m=h.data,v=h.dimensions,y=h.selectedService,g=this.r(),b=2*Math.PI*p,x=function(e){return-(e-0)-0},S=u.scaleLinear().domain([0,b]).range([.1*g,g]),k=u.range(0,b+.001,(b-0)/1e3),E=u.radialLine().curve(u.curveCardinal).angle(x).radius(S),O=v.find((function(e){return e.key===y})),j=O?[null!==(e=O.range[0])&&void 0!==e?e:0,null!==(t=O.range[1])&&void 0!==t?t:0]:[0,0],D=u.scaleSequential().interpolator(u.interpolateSpectral).domain(j.slice().reverse()),T=u.scaleLinear().domain("rank"===f?[0,m.length-1]:j).range([0,b]),C="rank"===f?"order":y;return l.a.createElement("div",{style:{width:i+" px",height:o+" px",position:"relative"}},l.a.createElement("svg",{className:a.svg,width:i,height:o,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 "+i+" "+o,ref:this.svgRef},l.a.createElement("g",{className:"content",transform:"translate("+this.centerX()+","+this.centerY()+")"},l.a.createElement("defs",null),l.a.createElement("path",{id:"#spiral",d:""+E(k),style:{fill:"none",stroke:"lightgrey",strokeDasharray:"6 5",opacity:.2}}),l.a.createElement("g",null,this.state.selectedData?this.draw_trajectory_contours(this.state.selectedData,"rank"===f?this.state.ranking.byComputer[this.state.selectedData.id][y]:Object.values(this.state.dataByTime[this.state.selectedData.id]).map((function(e){return e[y]})),S,T,x):""),m.map((function(e){var t=T(e[null!=C?C:""]),a=x(t),r=S(t),i=r*Math.sin(a),o=-r*Math.cos(a);return l.a.createElement("circle",{cx:i,cy:o,r:d,fill:""+D(e[null!=y?y:""]),opacity:n.state.selectedData?n.state.selectedData===e?1:.1:1,onMouseOver:function(){n.state.freeze||n.setState({selectedData:e})},onClick:function(){n.state.freeze&&n.setState({selectedData:void 0}),n.setState({freeze:!n.state.freeze})},onMouseOut:function(){n.state.freeze||n.setState({selectedData:void 0})}})})))),l.a.createElement("div",{style:{position:"absolute"}},l.a.createElement("select",{onChange:function(e){n.sortByService(n.state.data,""+e.target.value),n.setState({selectedService:e.target.value})}},v.map((function(e){return l.a.createElement("option",{key:e.key,value:e.key},e.key)}))),l.a.createElement(c.Slider,{min:0,max:this.state.timeStamp.length-1,step:1,onChange:this.onChangeTime.bind(this)})),this.state.selectedData?l.a.createElement("div",{className:a.tooltip},l.a.createElement("table",null,l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"Value"))),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",{className:a.tableCell},"Node"),l.a.createElement("td",{className:a.tableCell},this.state.selectedData.id)),v.map((function(e){return l.a.createElement("tr",{style:{fontWeight:e.key===y?"bold":"normal"}},l.a.createElement("td",{className:a.tableCell},e.key),l.a.createElement("td",{className:a.tableCell},n.state.selectedData?u.format(".2f")(n.state.selectedData[e.key]):"-"))}))))):"")},t.defaultProps={width:100,height:100,margin:{top:0,bottom:0,left:0,right:0},scalezoom:1},t}(l.a.Component),w=Object(c.stylesFactory)((function(){return{wrapper:Object(s.css)(p||(p=i(["\n      position: relative;\n    "],["\n      position: relative;\n    "]))),legend:Object(s.css)(f||(f=i(["\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow-y:auto;\n      max-height: 50%;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow-y:auto;\n      max-height: 50%;\n    "]))),legendColor:Object(s.css)(h||(h=i(["\n      width: 10px;\n      height: 10px;\n      margin-right:2px;\n      display: inline-block;\n    "],["\n      width: 10px;\n      height: 10px;\n      margin-right:2px;\n      display: inline-block;\n    "]))),svg:Object(s.css)(m||(m=i(["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "],["\n      position: absolute;\n      top: 0;\n      left: 0;\n    "]))),tooltip:Object(s.css)(v||(v=i(["\n            position: absolute;\n      top: 0;\n      right: 0;\n        "],["\n            position: absolute;\n      top: 0;\n      right: 0;\n        "]))),textBox:Object(s.css)(y||(y=i(["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "],["\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      padding: 10px;\n    "]))),tableCell:Object(s.css)(g||(g=i(["\n         padding-left: 5px;\n         padding-right: 5px;\n         "],["\n         padding-left: 5px;\n         padding-right: 5px;\n         "])))}}));n.d(t,"plugin",(function(){return x}));var x=new a.PanelPlugin(b).setPanelOptions((function(e){return e.addSelect({path:"orderType",name:"Order Type",defaultValue:"rank",settings:{options:[{label:"Ranking",value:"rank"},{label:"Metric",value:"value"}]}}).addNumberInput({path:"numberOfRing",name:"#Ring",defaultValue:5}).addNumberInput({path:"nodeSize",name:"Node Size",defaultValue:5})}))}])}));
//# sourceMappingURL=module.js.map